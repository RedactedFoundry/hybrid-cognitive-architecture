<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAC Unified Command Center</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        .glass { backdrop-filter: blur(12px); }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
    const BG = "#15141c";
    const ACCENT = "#232046";
    const PURPLE = "#7c5cf6";
    const TXT_MUTED = "#a1a1aa";
    const GLASS = { bg: "rgba(255,255,255,0.15)", border: "rgba(255,255,255,0.2)", subtle: "rgba(255,255,255,0.10)" };
    const COST_PER_TOKEN = 0.0000025;

    const uid = () => Math.random().toString(36).slice(2);
    const now = () => new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

    function HACUnifiedUI() {
        const [page, setPage] = useState("council");
        const [collapsed, setCollapsed] = useState(false);
        const [mode, setMode] = useState("SUPERVISED");
        const [showSettings, setShowSettings] = useState(false);
        const [showTreasury, setShowTreasury] = useState(false);
        const [showAgents, setShowAgents] = useState(false);
        const [showPheromind, setShowPheromind] = useState(false);
        const [lastRequestId, setLastRequestId] = useState(null);
        const [tokens, setTokens] = useState(0);
        const [showNotifications, setShowNotifications] = useState(false);
        const [notifications, setNotifications] = useState([
            { id: uid(), ts: "3m", label: "Budget threshold near for content_creator_01", level: "warning", unread: true },
            { id: uid(), ts: "12m", label: "Constitutional check flagged content-risk reply", level: "alert", unread: true },
            { id: uid(), ts: "1h", label: "TigerGraph uptime 98% past 24h", level: "info", unread: false }
        ]);
        const [showSearch, setShowSearch] = useState(false);
        const [searchQuery, setSearchQuery] = useState("");
        const commands = ["/analyze", "/budget", "/pheromind", "/schedule", "/execute"];
        const [slashOpen, setSlashOpen] = useState(false);
        const [filteredCommands, setFilteredCommands] = useState(commands);
		const [showPalette, setShowPalette] = useState(false);

        const [collections] = useState([
            { id: uid(), name: "All" },
            { id: uid(), name: "Work" },
            { id: uid(), name: "Research" },
            { id: uid(), name: "Personal" }
        ]);
        const [activeCollection, setActiveCollection] = useState("All");
        const [pinned] = useState([
            { id: uid(), title: "Quarterly Strategy", unread: 0, collection: "Work" },
            { id: uid(), title: "Crypto Rebalance", unread: 2, collection: "Research" }
        ]);
        const [recents] = useState([
            { id: uid(), title: "Agent Budget Tuning", unread: 0, collection: "Work" },
            { id: uid(), title: "Marketing Experiment", unread: 1, collection: "Work" },
            { id: uid(), title: "Model Upgrade Review", unread: 0, collection: "Personal" }
        ]);
        const [activeConvId, setActiveConvId] = useState(pinned[0].id);
        const activeConv = [...pinned, ...recents].find(c => c.id === activeConvId);

        const [messages, setMessages] = useState([
            { id: uid(), role: "user", ts: now(), text: "Help me analyze the crypto market for portfolio rebalancing." },
            { id: uid(), role: "assistant", ts: now(), status: "complete", verified: true, text: "I've analyzed the current crypto market conditions. Based on volatility indices and correlation patterns, I recommend a 5% rebalancing from BTC to ETH, with 3% allocation to stablecoins for risk mitigation." }
        ]);
        const [composer, setComposer] = useState("");
        const [streaming, setStreaming] = useState(false);
        const taRef = useRef(null);
        const listRef = useRef(null);
        const streamRef = useRef({ timeout: null });

        useEffect(() => {
            if (!taRef.current) return;
            const el = taRef.current;
            el.style.height = "auto";
            const lh = 28;
            el.style.height = Math.min(el.scrollHeight, lh * 6) + "px";
        }, [composer]);

        // Keyboard shortcuts: Alt+1..6 to change tabs, Esc to stop
        useEffect(() => {
            const handler = (e) => {
                if (e.altKey) {
                    if (e.key === '1') setPage('council');
                    else if (e.key === '2') setPage('kip');
                    else if (e.key === '3') setPage('pheromind');
                    else if (e.key === '4') setPage('calendar');
                    else if (e.key === '5') setPage('projects');
                    else if (e.key === '6') setPage('system');
                }
                if (e.key === 'Escape' && streaming) {
                    e.preventDefault();
                    stop();
                }
            };
            window.addEventListener('keydown', handler);
            return () => window.removeEventListener('keydown', handler);
        }, [streaming]);

        // Slash command assist
        useEffect(() => {
            const q = composer.trim();
            if (q.startsWith('/')) {
                setSlashOpen(true);
                const needle = q.slice(1).toLowerCase();
                setFilteredCommands(commands.filter(c => c.includes(needle)));
            } else {
                setSlashOpen(false);
            }
        }, [composer]);

        useEffect(() => {
            if (!streaming) return;
            const id = setInterval(() => setTokens(prev => prev + 8), 200);
            return () => clearInterval(id);
        }, [streaming]);

        const [treasury] = useState({
            balance: 2847,
            allocated: 1203,
            weekPnL: 546,
            tx: [
                { id: uid(), ts: "2m", label: "Constitutional verification", amount: -4.18 },
                { id: uid(), ts: "8m", label: "API usage", amount: -39.6 },
                { id: uid(), ts: "1h", label: "GPU hours", amount: -12.0 },
                { id: uid(), ts: "1h", label: "Client payment", amount: 210.0 }
            ]
        });

        const agents = [
            { id: uid(), name: "Sarah", role: "ContentCreation_Agent", revenue: 347, spend: 89, net: 258 },
            { id: uid(), name: "StockAnalyst_Agent", role: "Equities", revenue: 160, spend: 48, net: 112 },
            { id: uid(), name: "MarketResearch_Agent", role: "Insights", revenue: 240, spend: 64, net: 176 }
        ];

        const [edges, setEdges] = useState([
            { a: "Bitcoin", b: "Inflation", s: 0.82 },
            { a: "Inflation", b: "Gold", s: 0.80 },
            { a: "AI regulation", b: "European markets", s: 0.87 }
        ]);

        useEffect(() => {
            const interval = setInterval(() => {
                setEdges(prev => prev.map(e => ({ ...e, s: Math.max(0.2, e.s - 0.01) })));
            }, 1000);
            return () => clearInterval(interval);
        }, []);

        const reinforce = (idx) => {
            setEdges(prev => prev.map((e, i) => i === idx ? { ...e, s: Math.min(0.95, e.s + 0.15) } : e));
        };

        const filterByCollection = (convs) => {
            if (activeCollection === "All") return convs;
            return convs.filter(c => c.collection === activeCollection);
        };

        const send = () => {
            if (!composer.trim() || streaming) return;
            const userMsg = { id: uid(), role: "user", ts: now(), text: composer.trim() };
            setMessages(prev => [...prev, userMsg]);
            setComposer("");
            setTokens(0);
            setStreaming(true);
            const reqId = uid();
            setLastRequestId(reqId);
            const aiId = uid();
            const aiMsg = { id: aiId, role: "assistant", ts: now(), status: "generating", text: "Analyzing market conditions..." };
            setMessages(prev => [...prev, aiMsg]);
            streamRef.current.timeout = setTimeout(() => {
                setMessages(prev => prev.map(m => m.id === aiId ? { ...m, status: "verifying", text: "Running constitutional verification on the analysis..." } : m));
                setTimeout(() => {
                    setMessages(prev => prev.map(m => m.id === aiId ? { ...m, status: "complete", verified: true, text: "Based on current market analysis: BTC dominance at 48%, ETH showing strong momentum. Recommend 5% portfolio rebalancing with risk-adjusted stops at -8%. Constitutional verification passed with 0.94 confidence." } : m));
                    setStreaming(false);
                }, 1500);
            }, 1500);
        };

        const stop = () => {
            if (streamRef.current.timeout) { clearTimeout(streamRef.current.timeout); }
            setStreaming(false);
            setMessages(prev => prev.map(m => (m.status === "generating" || m.status === "verifying") ? { ...m, status: "complete", text: m.text + " (interrupted)" } : m));
        };

        useEffect(() => {
            if (listRef.current) { listRef.current.scrollTop = listRef.current.scrollHeight; }
        }, [messages]);

		useEffect(() => {
			const onKey = (e) => {
				if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
					e.preventDefault();
					setShowPalette((v) => !v);
				}
			};
			window.addEventListener('keydown', onKey);
			return () => window.removeEventListener('keydown', onKey);
		}, []);

        return (
            <div className="min-h-screen" style={{ background: BG, color: "#fff" }}>
                <header className="h-20 flex items-center justify-between px-12 border-b relative z-50" style={{ borderColor: "rgba(255,255,255,0.12)" }}>
                    <div className="flex items-center gap-6">
                        <div className="h-12 w-12 rounded-2xl grid place-items-center" style={{ background: ACCENT, boxShadow: `0 0 0 1px ${PURPLE}44, 0 12px 36px ${PURPLE}33` }}>
                            <div className="h-7 w-7 rounded-xl" style={{ background: `linear-gradient(135deg, ${PURPLE}, ${ACCENT})` }} />
                        </div>
					<nav className="flex items-center gap-2 p-1 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
						{["council", "kip", "treasury", "pheromind", "calendar", "projects", "system"].map(p => (
							<button
								key={p}
								onClick={() => setPage(p)}
								className={`px-3 py-2 rounded-lg capitalize text-sm transition-all ${page === p ? "bg-[rgba(255,255,255,0.10)] shadow" : ""}`}
								style={{ border: `1px solid ${GLASS.border}` }}
							>
								{p === "kip" ? "KIP Engine" : p === "treasury" ? "Treasury" : p}
							</button>
						))}
					</nav>
                        <div className="text-xl font-semibold">Hybrid AI Council</div>
                    </div>
                    <div className="flex items-center gap-6">
                        <div className="relative">
                            <button onClick={() => setShowSearch(!showSearch)} className="px-3 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <span>Search</span>
                            </button>
                            {showSearch && (
                                <div className="absolute right-0 mt-2 w-[420px] p-3 rounded-2xl border" style={{ background: BG, borderColor: GLASS.border }}>
                                    <input autoFocus value={searchQuery} onChange={(e)=>setSearchQuery(e.target.value)} placeholder="Search conversations, agents, signals..." className="w-full bg-transparent outline-none text-sm px-3 py-2 rounded-xl border" style={{ borderColor: GLASS.border }} />
                                    <div className="mt-2 text-xs" style={{ color: TXT_MUTED }}>Try: "budget threshold", "ai regulation", "agent Sarah"</div>
                                </div>
                            )}
                        </div>
                        <div className="relative">
                            <button onClick={() => setShowNotifications(!showNotifications)} className="px-3 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <span>Notifications</span>
                                {notifications.some(n=>n.unread) && (
                                    <span className="ml-2 inline-block text-xs px-2 py-0.5 rounded-lg" style={{ background: 'rgba(244,63,94,0.25)' }}>{notifications.filter(n=>n.unread).length}</span>
                                )}
                            </button>
                            {showNotifications && (
                                <div className="absolute right-0 mt-2 w-[420px] p-2 rounded-2xl border" style={{ background: BG, borderColor: GLASS.border }}>
                                    {notifications.map(n => (
                                        <div key={n.id} className="p-3 mb-2 rounded-xl border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <div className="text-sm">{n.label}</div>
                                            <div className="text-xs mt-1" style={{ color: TXT_MUTED }}>{n.ts} • {n.level}</div>
                                        </div>
                                    ))}
                                    <div className="text-right">
                                        <button onClick={()=>setNotifications(prev=>prev.map(x=>({...x, unread:false})))} className="px-3 py-1 rounded-xl border text-xs" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Mark all read</button>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="px-4 py-2 rounded-xl border glass flex items-center gap-3" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                            <span className="text-sm" style={{ color: TXT_MUTED }}>WS</span>
                            <span className="text-emerald-400">Connected</span>
                            {lastRequestId && (
                                <span className="text-xs" style={{ color: TXT_MUTED }}>req: {lastRequestId.slice(0,6)}…</span>
                            )}
                        </div>
                        <button onClick={() => setShowSettings(true)} className="px-4 py-2 rounded-xl border text-sm inline-flex items-center gap-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            Settings
                        </button>
                    </div>
                </header>

                <div className="grid grid-cols-12 gap-8 mx-8 my-8">
                    <aside className="col-span-3" style={{ width: collapsed ? 80 : 320, transition: "width .2s" }}>
                        <div className="flex items-center justify-between mb-6">
                            <div className="text-lg font-medium" style={{ color: TXT_MUTED }}>{!collapsed && "Conversations"}</div>
                            <button onClick={() => setCollapsed(!collapsed)} className="p-3 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                {collapsed ? "→" : "←"}
                            </button>
                        </div>
                        {!collapsed && (
                            <>
                                <div className="mb-4">
                                    <div className="flex items-center gap-3 px-4 py-3 rounded-2xl border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                        <input placeholder="Search conversations..." className="bg-transparent outline-none text-base flex-1" />
                                    </div>
                                </div>
                                <div className="mb-6 flex items-center flex-wrap gap-2">
                                    {collections.map(c => (
                                        <button key={c.id} onClick={() => setActiveCollection(c.name)} className="px-3 py-1 rounded-xl border text-sm transition-all" style={{ background: activeCollection === c.name ? PURPLE + "30" : GLASS.bg, borderColor: GLASS.border, opacity: activeCollection === c.name ? 1 : 0.8 }}>
                                            {c.name}
                                        </button>
                                    ))}
                                    <button className="px-3 py-1 rounded-xl border text-sm inline-flex items-center gap-1" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <span>+</span> New
                                    </button>
                                </div>
                                <div className="mb-6">
                                    <div className="text-sm mb-3" style={{ color: TXT_MUTED }}>Pinned</div>
                                    <div className="space-y-3">
                                        {filterByCollection(pinned).map(conv => (
                                            <button key={conv.id} onClick={() => setActiveConvId(conv.id)} className="w-full rounded-2xl p-4 text-left transition-all" style={{ background: activeConvId === conv.id ? ACCENT : GLASS.subtle, border: `1px solid ${GLASS.border}`, boxShadow: activeConvId === conv.id ? `0 8px 24px ${PURPLE}33` : "none" }}>
                                                <div className="text-base font-medium">{conv.title}</div>
                                                {conv.unread > 0 && (
                                                    <span className="text-xs px-2 py-1 rounded-lg mt-1 inline-block" style={{ background: PURPLE + "30" }}>{conv.unread} new</span>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <div className="text-sm mb-3" style={{ color: TXT_MUTED }}>Recent</div>
                                    <div className="space-y-3">
                                        {filterByCollection(recents).map(conv => (
                                            <button key={conv.id} onClick={() => setActiveConvId(conv.id)} className="w-full rounded-2xl p-4 text-left transition-all" style={{ background: activeConvId === conv.id ? ACCENT : GLASS.subtle, border: `1px solid ${GLASS.border}`, boxShadow: activeConvId === conv.id ? `0 8px 24px ${PURPLE}33` : "none" }}>
                                                <div className="text-base font-medium">{conv.title}</div>
                                                {conv.unread > 0 && (
                                                    <span className="text-xs px-2 py-1 rounded-lg mt-1 inline-block" style={{ background: PURPLE + "30" }}>{conv.unread} new</span>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}
                    </aside>

                    <main className="col-span-6">
                        {page === "council" && (
                            <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="flex items-center justify-between mb-6">
                                    <div>
                                        <div className="text-2xl font-semibold">{activeConv?.title || "Council"}</div>
                                        <div className="mt-2 flex items-center gap-2">
                                            <span className="text-xs" style={{ color: TXT_MUTED }}>Collection:</span>
                                            <select className="text-xs px-2 py-1 rounded-lg border bg-transparent" style={{ borderColor: GLASS.border }} value={activeConv?.collection || "All"}>
                                                {collections.map(c => (
                                                    <option key={c.id} value={c.name} style={{ background: BG }}>{c.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="text-sm mt-2" style={{ color: TXT_MUTED }}>Unified response with constitutional verification • Send→Stop toggle while streaming</div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        {["/analyze", "/budget", "/pheromind"].map(cmd => (
                                            <button key={cmd} onClick={() => setComposer(composer + " " + cmd + " ")} className="px-4 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>{cmd}</button>
                                        ))}
                                    </div>
                                </div>
                                <div ref={listRef} className="space-y-6 pr-1 scrollbar-thin" style={{ maxHeight: 440, overflow: "auto" }}>
                                    {messages.map(m => (
                                        <div key={m.id} className={`flex gap-4 ${m.role === "user" ? "flex-row-reverse" : ""}`}>
                                            <div className="h-10 w-10 rounded-2xl grid place-items-center flex-shrink-0" style={{ background: m.role === "user" ? "rgba(255,255,255,0.12)" : ACCENT }}>
                                                <span className="text-sm font-medium">{m.role === "user" ? "U" : "AI"}</span>
                                            </div>
                                            <div className="flex-1">
                                                <div className="text-lg leading-relaxed rounded-2xl p-6 border relative" style={{ background: GLASS.subtle, borderColor: GLASS.border, boxShadow: m.role === "user" ? "none" : `0 8px 24px ${PURPLE}22` }}>
                                                    {m.text}
                                                    {m.role === "assistant" && (
                                                        <div className="mt-3 flex items-center gap-2 text-sm">
                                                            {m.status === "generating" && (
                                                                <>
                                                                    <span className="px-3 py-1 rounded-xl" style={{ background: "rgba(251,191,36,0.15)" }}>Generating...</span>
                                                                    <button onClick={stop} className="px-3 py-1 rounded-xl border inline-flex items-center gap-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" /></svg>
                                                                        Stop
                                                                    </button>
                                                                </>
                                                            )}
                                                            {m.status === "verifying" && (
                                                                <>
                                                                    <span className="px-3 py-1 rounded-xl" style={{ background: "rgba(59,130,246,0.20)" }}>Verifying...</span>
                                                                    <button onClick={stop} className="px-3 py-1 rounded-xl border inline-flex items-center gap-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" /></svg>
                                                                        Stop
                                                                    </button>
                                                                </>
                                                            )}
                                                            {m.status === "complete" && m.verified && (
                                                                <span className="px-3 py-1 rounded-xl inline-flex items-center gap-2" style={{ background: "rgba(16,185,129,0.2)" }}>
                                                                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                                                    Verified
                                                                </span>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="mt-3 flex items-center gap-3 text-sm" style={{ color: TXT_MUTED }}>
                                                    <span>{m.ts}</span>
                                                    {m.role === "assistant" && mode === "MANUAL" && m.status === "complete" && (
                                                        <>
                                                            <button className="px-3 py-1 rounded-xl border inline-flex items-center gap-1" style={{ background: "rgba(34,197,94,0.18)", borderColor: GLASS.border }}>
                                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>
                                                                Approve
                                                            </button>
                                                            <button className="px-3 py-1 rounded-xl border inline-flex items-center gap-1" style={{ background: "rgba(244,63,94,0.18)", borderColor: GLASS.border }}>
                                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                                                                Reject
                                                            </button>
                                                        </>
                                                    )}
                                                    {m.role === "assistant" && (
                                                        <>
                                                            <button className="px-3 py-1 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Copy</button>
                                                            <button className="px-3 py-1 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Regenerate</button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-8 rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="text-base" style={{ color: TXT_MUTED }}>{composer ? "" : "Available: /analyze  /budget  /pheromind"}</div>
                                        <div className="flex items-center gap-3">
                                            <button className="p-3 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" /></svg>
                                            </button>
                                            <button className="p-3 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                                            </button>
                                        </div>
                                    </div>
                                    {/* Slash Commands */}
                                    {slashOpen && (
                                        <div className="mt-2 rounded-xl border p-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                            <div className="text-xs mb-1" style={{ color: TXT_MUTED }}>Commands</div>
                                            <div className="flex flex-wrap gap-2">
                                                {filteredCommands.map(cmd => (
                                                    <button key={cmd} onClick={()=>setComposer(cmd+" ")} className="px-2 py-1 rounded-lg border text-xs" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>{cmd}</button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    <textarea ref={taRef} value={composer} onChange={(e) => setComposer(e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter' && e.metaKey) { e.preventDefault(); send(); } }} rows={1} placeholder="Type a message..." className="w-full bg-transparent outline-none text-lg placeholder-white/40 resize-none" style={{ lineHeight: "28px", maxHeight: 28 * 6 }} />
                                    <div className="mt-4 flex items-center justify-between">
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>
                                            Press ⌘↩ to send • Tokens: {tokens} • Est cost: ${ (tokens * COST_PER_TOKEN).toFixed(4) }
                                        </div>
                                        {!streaming ? (
                                            <button onClick={send} className="px-6 py-3 rounded-2xl text-lg font-medium border inline-flex items-center gap-2" style={{ background: ACCENT, borderColor: GLASS.border, boxShadow: `0 8px 30px ${PURPLE}33` }}>
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                                                Send
                                            </button>
                                        ) : (
                                            <button onClick={stop} className="px-6 py-3 rounded-2xl text-lg font-medium border inline-flex items-center gap-2" style={{ background: "rgba(244,63,94,0.2)", borderColor: "rgba(244,63,94,0.5)" }}>
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" /></svg>
                                                Stop generating
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {page === "kip" && (
                            <div className="rounded-3xl p-8 border glass space-y-8" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="flex items-center justify-between">
                                    <div className="text-2xl font-semibold">KIP Engine — Operations</div>
                                    <button onClick={() => setShowAgents(true)} className="px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                                        Expand
                                    </button>
                                </div>
                                <div className="grid grid-cols-3 gap-6">
                                    {agents.map(a => (
                                        <div key={a.id} className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <div className="text-lg font-medium">{a.name}</div>
                                                    <div className="text-sm" style={{ color: TXT_MUTED }}>{a.role}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm" style={{ color: TXT_MUTED }}>Net</div>
                                                    <div className={`text-xl font-semibold ${a.net >= 0 ? "text-emerald-300" : "text-rose-300"}`}>{a.net >= 0 ? "+$" + a.net : "-$" + Math.abs(a.net)}</div>
                                                </div>
                                            </div>
                                            <svg viewBox="0 0 180 44" className="mt-3 w-full h-10">
                                                <polyline fill="none" stroke="#34d399" strokeWidth="2" points="10,34 40,28 70,20 100,22 130,16 160,18" />
                                                <polyline fill="none" stroke="#f87171" strokeWidth="2" points="10,30 40,32 70,26 100,28 130,24 160,26" />
                                            </svg>
                                            <div className="grid grid-cols-3 gap-4 mt-4 text-sm">
                                                <div>Revenue <span className="text-emerald-300">${a.revenue}</span></div>
                                                <div>Spend <span className="text-rose-300">${a.spend}</span></div>
                                                <button className="px-3 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Details</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {page === "pheromind" && (
                            <div className="rounded-3xl p-8 border glass space-y-6" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="flex items-center justify-between">
                                    <div className="text-2xl font-semibold">Pheromind — Concept Trails</div>
                                    <button onClick={() => setShowPheromind(true)} className="px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
                                        Expand
                                    </button>
                                </div>
                                <div className="rounded-2xl p-4 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <svg viewBox="0 0 260 140" className="w-full h-[120px]">
                                        {edges.map((e, i) => {
                                            const pos = (s) => s.split("").reduce((h, c) => (h * 31 + c.charCodeAt(0)) >>> 0, 0);
                                            const A = { x: 40 + (pos(e.a) % 180), y: 30 + ((pos(e.a) >> 5) % 90) };
                                            const B = { x: 40 + (pos(e.b) % 180), y: 30 + ((pos(e.b) >> 5) % 90) };
                                            return (
                                                <g key={i}>
                                                    <defs>
                                                        <linearGradient id={`mini${i}`} x1="0" y1="0" x2="1" y2="1">
                                                            <stop offset="0%" stopColor={PURPLE} />
                                                            <stop offset="100%" stopColor="#c084fc" />
                                                        </linearGradient>
                                                    </defs>
                                                    <line x1={A.x} y1={A.y} x2={B.x} y2={B.y} stroke={`url(#mini${i})`} strokeWidth={Math.max(1.2, e.s * 6)} strokeOpacity={0.9} />
                                                    <circle cx={A.x} cy={A.y} r={7} fill="#0f0e14" stroke="#a78bfa" strokeWidth={2} />
                                                    <circle cx={B.x} cy={B.y} r={7} fill="#0f0e14" stroke="#a78bfa" strokeWidth={2} />
                                                </g>
                                            );
                                        })}
                                    </svg>
                                    <div className="mt-2 text-xs" style={{ color: TXT_MUTED }}>Thicker lines = stronger connection; edges decay over ~12s</div>
                                </div>
                                <div className="flex gap-3">
                                    {edges.map((_, i) => (
                                        <button key={i} onClick={() => reinforce(i)} className="px-4 py-2 rounded-xl text-sm border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                            Reinforce #{i + 1}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {page === "calendar" && (
                            <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="text-2xl font-semibold mb-6">Calendar — Missions</div>
                                <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="grid grid-cols-6 gap-3 text-xs mb-3" style={{ color: TXT_MUTED }}>
                                        <div>Agent</div>
                                        {["Mon","Tue","Wed","Thu","Fri"].map(d => (<div key={d} className="text-center">{d}</div>))}
                                    </div>
                                    {["Sarah","StockAnalyst_Agent","MarketResearch_Agent"].map((name, idx) => (
                                        <div key={name} className="grid grid-cols-6 gap-3 mb-2">
                                            <div className="px-2 py-1 rounded-lg border text-xs" style={{ background: GLASS.bg, borderColor: GLASS.border }}>{name}</div>
                                            {[0,1,2,3,4].map(i => (
                                                <div key={i} className="h-8 rounded-lg border" style={{ background: idx===0 && i===2 ? "rgba(124,92,246,0.25)" : GLASS.bg, borderColor: GLASS.border }} />
                                            ))}
                                        </div>
                                    ))}
                                    <div className="text-xs mt-3" style={{ color: TXT_MUTED }}>Static capacity lanes; drag-drop planned in full build</div>
                                </div>
                            </div>
                        )}

                        {page === "projects" && (
                            <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="text-2xl font-semibold mb-6">Projects — Mission Control</div>
                                <div className="grid grid-cols-3 gap-6">
                                    {["Planning","Active","Review"].map(col => (
                                        <div key={col} className="rounded-2xl p-4 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="font-medium">{col}</div>
                                                <button className="px-2 py-1 rounded-lg border text-xs" style={{ background: GLASS.bg, borderColor: GLASS.border }}>+ Add</button>
                                            </div>
                                            <div className="space-y-3">
                                                {[1,2].map(i => (
                                                    <div key={i} className="p-3 rounded-xl border" style={{ background: BG, borderColor: GLASS.border }}>
                                                        <div className="text-sm font-medium">{col} Task #{i}</div>
                                                        <div className="text-xs mt-1" style={{ color: TXT_MUTED }}>Owner: Agent {i} • Due: T+{i}d</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {page === "treasury" && (
                            <div className="rounded-3xl p-8 border glass space-y-8" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="flex items-center justify-between">
                                    <div className="text-2xl font-semibold">Treasury — Financial Dashboard</div>
                                    <div className="flex items-center gap-2">
                                        <button className="px-3 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Export CSV</button>
                                        <button className="px-3 py-2 rounded-xl border text-sm" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Export JSON</button>
                                    </div>
                                </div>
                                {/* Executive Summary */}
                                <div className="grid grid-cols-4 gap-6">
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Balance</div>
                                        <div className="text-3xl font-semibold mt-1">${treasury.balance}</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Allocated</div>
                                        <div className="text-3xl font-semibold mt-1">${treasury.allocated}</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Weekly P&L</div>
                                        <div className="text-3xl font-semibold text-emerald-300 mt-1">+${treasury.weekPnL}</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Burn Rate (est.)</div>
                                        <div className="text-3xl font-semibold mt-1">$412/mo</div>
                                    </div>
                                </div>
                                <div className="grid grid-cols-3 gap-6">
                                    {/* Trend + Cash Flow */}
                                    <div className="col-span-2 rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="text-lg font-medium">Weekly Trend</div>
                                            <div className="flex items-center gap-2 text-xs" style={{ color: TXT_MUTED }}>
                                                <span>Revenue</span>
                                                <span className="inline-block w-3 h-3 rounded" style={{ background: "#34d399" }} />
                                                <span>Spend</span>
                                                <span className="inline-block w-3 h-3 rounded" style={{ background: "#f87171" }} />
                                            </div>
                                        </div>
                                        <svg viewBox="0 0 400 160" className="w-full h-40">
                                            <polyline fill="none" stroke="#34d399" strokeWidth="3" points="20,130 75,120 130,90 185,95 240,70 295,80 350,55" />
                                            <polyline fill="none" stroke="#f87171" strokeWidth="3" points="20,110 75,112 130,100 185,105 240,92 295,95 350,90" />
                                            <line x1="20" y1="140" x2="380" y2="140" stroke="rgba(255,255,255,0.2)" />
                                            <line x1="20" y1="20" x2="20" y2="140" stroke="rgba(255,255,255,0.2)" />
                                        </svg>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-2">Cash Flow</div>
                                        <ul className="space-y-2 text-sm">
                                            <li className="flex justify-between"><span style={{ color: TXT_MUTED }}>Revenue (7d)</span><span className="text-emerald-300">+$370</span></li>
                                            <li className="flex justify-between"><span style={{ color: TXT_MUTED }}>Spend (7d)</span><span className="text-rose-300">-$158</span></li>
                                            <li className="flex justify-between"><span style={{ color: TXT_MUTED }}>Net</span><span>+$212</span></li>
                                        </ul>
                                    </div>
                                </div>
                                {/* Agent P&L */}
                                <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="text-lg font-medium mb-3">Agent Financial Performance</div>
                                    <div className="grid grid-cols-4 text-sm font-medium" style={{ color: TXT_MUTED }}>
                                        <div>Agent</div>
                                        <div>Revenue</div>
                                        <div>Spend</div>
                                        <div>Margin</div>
                                    </div>
                                    <div className="mt-2 space-y-2 text-sm">
                                        {agents.map(a => (
                                            <div key={a.id} className="grid grid-cols-4 p-3 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                <div>{a.name}</div>
                                                <div className="text-emerald-300">${a.revenue}</div>
                                                <div className="text-rose-300">${a.spend}</div>
                                                <div className={a.net >= 0 ? "text-emerald-300" : "text-rose-300"}>{a.net >= 0 ? "+$"+a.net : "-$"+Math.abs(a.net)}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                {/* Risk & Scenarios + Ledger */}
                                <div className="grid grid-cols-3 gap-6">
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-2">Risk Management</div>
                                        <ul className="space-y-2 text-sm">
                                            <li className="p-2 rounded-lg" style={{ background: "rgba(251,191,36,0.15)" }}>Budget threshold near for content_creator_01</li>
                                            <li className="p-2 rounded-lg" style={{ background: "rgba(248,113,113,0.15)" }}>API spend alert: +34% over baseline</li>
                                        </ul>
                                        <div className="mt-3 text-xs" style={{ color: TXT_MUTED }}>Supervised rules mitigate small risks automatically</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-2">Planning Scenarios</div>
                                        <div className="flex flex-wrap gap-2 text-sm">
                                            <button className="px-3 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Conservative</button>
                                            <button className="px-3 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Balanced</button>
                                            <button className="px-3 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Aggressive</button>
                                        </div>
                                        <div className="text-xs mt-3" style={{ color: TXT_MUTED }}>Non-functional mock controls</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-4">Searchable Ledger</div>
                                        <div className="mb-2">
                                            <input placeholder="Search transactions..." className="w-full bg-transparent outline-none text-sm px-3 py-2 rounded-xl border" style={{ borderColor: GLASS.border }} />
                                        </div>
                                        <ul className="space-y-2 text-sm">
                                            {treasury.tx.map(t => (
                                                <li key={t.id} className="flex items-center justify-between px-3 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                                    <span>{t.ts} • {t.label}</span>
                                                    <span className={t.amount >= 0 ? "text-emerald-300" : "text-rose-300"}>{t.amount >= 0 ? "+$" + t.amount : "-$" + Math.abs(t.amount)}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}

                        {page === "system" && (
                            <div className="rounded-3xl p-8 border glass space-y-6" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                <div className="text-2xl font-semibold">System — Governance & Audit</div>
                                <div className="grid grid-cols-3 gap-6">
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-4">Operational Mode</div>
                                        <div className="flex flex-col gap-3">
                                            {["MANUAL", "SUPERVISED", "AUTONOMOUS"].map(m => (
                                                <button key={m} onClick={() => setMode(m)} className="px-4 py-3 rounded-xl text-sm font-medium border transition-all" style={{ background: mode === m ? "rgba(124,92,246,0.25)" : GLASS.bg, borderColor: GLASS.border, boxShadow: mode === m ? `0 8px 24px ${PURPLE}33` : "none" }}>
                                                    {m}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-2">Tool Permissions</div>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Registry placeholder</div>
                                    </div>
                                    <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="text-lg font-medium mb-2">Audit & Compliance</div>
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <div className="font-medium mb-1">Decision History</div>
                                                <ul className="space-y-1">
                                                    <li>12m • Budget approval under $50</li>
                                                    <li>35m • Risk flag: content sensitivity</li>
                                                </ul>
                                            </div>
                                            <div>
                                                <div className="font-medium mb-1">Financial Decision Log</div>
                                                <ul className="space-y-1">
                                                    <li>2h • Allocated $120 to Research</li>
                                                    <li>4h • API spend alert triggered</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <aside className="col-span-3">
                        <div className="flex flex-col gap-6">
                            {page === "council" && (
                                <>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="text-xl font-semibold mb-3">Verification & Rationale</div>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Constitutional reasoning • TigerGraph traces • Confidence scores</div>
                                        <div className="mt-4 p-3 rounded-xl border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <div className="text-sm">Last verification: 0.94 confidence</div>
                                        </div>
                                    </div>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="text-xl font-semibold mb-3">Suggested Actions</div>
                                        <ul className="space-y-2 text-sm">
                                            <li className="p-2 rounded-lg" style={{ background: GLASS.subtle }}>Run /analyze for risk assessment</li>
                                            <li className="p-2 rounded-lg" style={{ background: GLASS.subtle }}>Review agent allocations</li>
                                        </ul>
                                    </div>
                                </>
                            )}

                            {page === "kip" && (
                                <>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="flex items-center justify-between mb-6">
                                            <div className="text-xl font-semibold">Treasury</div>
                                            <button onClick={() => setShowTreasury(true)} className="px-3 py-2 rounded-xl text-sm border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Expand</button>
                                        </div>
                                        <div className="grid grid-cols-3 gap-4 mb-4">
                                            <div className="rounded-xl p-4 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                                <div className="text-xs" style={{ color: TXT_MUTED }}>Available</div>
                                                <div className="text-xl font-semibold">${treasury.balance}</div>
                                            </div>
                                            <div className="rounded-xl p-4 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                                <div className="text-xs" style={{ color: TXT_MUTED }}>Allocated</div>
                                                <div className="text-xl font-semibold">${treasury.allocated}</div>
                                            </div>
                                            <div className="rounded-xl p-4 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                                <div className="text-xs" style={{ color: TXT_MUTED }}>P&L (wk)</div>
                                                <div className="text-xl font-semibold text-emerald-300">+${treasury.weekPnL}</div>
                                            </div>
                                        </div>
                                        <div className="text-sm font-medium mb-2" style={{ color: TXT_MUTED }}>
                                            Recent transactions
                                        </div>
                                        <ul className="space-y-2">
                                            {treasury.tx.slice(0, 2).map(t => (
                                                <li key={t.id} className="flex items-center justify-between px-3 py-2 rounded-xl border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                                    <span className="text-sm">{t.ts} • {t.label}</span>
                                                    <span className={`text-sm ${t.amount >= 0 ? "text-emerald-300" : "text-rose-300"}`}>{t.amount >= 0 ? "+$" + t.amount : "-$" + Math.abs(t.amount)}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="text-xl font-semibold mb-3">Scheduling</div>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Auto-assign windows • Resource matrix</div>
                                    </div>
                                </>
                            )}

                            {page === "pheromind" && (
                                <>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="text-xl font-semibold mb-3">Emergent Insights</div>
                                        <ul className="space-y-2 text-sm">
                                            <li className="p-2 rounded-lg" style={{ background: GLASS.subtle }}>AI regulation ↔ European markets (87%)</li>
                                            <li className="p-2 rounded-lg" style={{ background: GLASS.subtle }}>Bitcoin → Inflation → Gold (73%)</li>
                                        </ul>
                                    </div>
                                    <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        <div className="text-xl font-semibold mb-3">Export / Consolidation</div>
                                        <div className="text-sm" style={{ color: TXT_MUTED }}>Export to project brief • Consolidate concepts</div>
                                    </div>
                                </>
                            )}

                            {page === "calendar" && (
                                <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                    <div className="text-xl font-semibold mb-3">Mission Brief</div>
                                    <div className="text-sm" style={{ color: TXT_MUTED }}>Objectives • Success metrics • Dependencies</div>
                                </div>
                            )}

                            {page === "projects" && (
                                <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                    <div className="text-xl font-semibold mb-3">Project Settings</div>
                                    <div className="text-sm" style={{ color: TXT_MUTED }}>Allocation • Permissions • Related operations</div>
                                </div>
                            )}

                            {page === "treasury" && (
                                <div className="rounded-3xl p-8 border glass" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                    <div className="text-xl font-semibold mb-3">Diagnostics</div>
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between"><span style={{ color: TXT_MUTED }}>TigerGraph</span><span className="text-emerald-400">98% uptime</span></div>
                                        <div className="flex justify-between"><span style={{ color: TXT_MUTED }}>Cloud APIs</span><span className="text-amber-400">94% uptime</span></div>
                                        <div className="flex justify-between"><span style={{ color: TXT_MUTED }}>Tailscale</span><span className="text-emerald-400">Connected</span></div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </aside>
                </div>

                {showSettings && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center" style={{ background: "rgba(0,0,0,0.7)" }} onClick={() => setShowSettings(false)}>
                        <div className="w-[600px] rounded-3xl p-12 border glass" style={{ background: BG, borderColor: GLASS.border }} onClick={(e) => e.stopPropagation()}>
                            <div className="text-2xl font-semibold mb-8">Settings</div>
                            <div className="space-y-8">
                                <section>
                                    <div className="text-lg font-medium mb-3">Operational Mode</div>
                                    <div className="flex gap-3">
                                        {["MANUAL", "SUPERVISED", "AUTONOMOUS"].map(m => (
                                            <button key={m} onClick={() => setMode(m)} className="px-5 py-3 rounded-2xl text-base font-medium border flex-1" style={{ background: mode === m ? "rgba(124,92,246,0.25)" : GLASS.bg, borderColor: GLASS.border }}>{m}</button>
                                        ))}
                                    </div>
                                </section>
                                <section>
                                    <div className="text-lg font-medium mb-3">Supervised Rules</div>
                                    <div className="space-y-3">
                                        <label className="flex items-center justify-between p-4 rounded-xl border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <span>Auto-approve actions under $50</span>
                                            <input type="checkbox" defaultChecked />
                                        </label>
                                        <label className="flex items-center justify-between p-4 rounded-xl border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                            <span>Flag content-risk replies</span>
                                            <input type="checkbox" defaultChecked />
                                        </label>
                                    </div>
                                </section>
                                <button onClick={() => setShowSettings(false)} className="w-full px-6 py-3 rounded-2xl text-lg font-medium border" style={{ background: ACCENT, borderColor: GLASS.border }}>Done</button>
                            </div>
                        </div>
                    </div>
                )}

                {showTreasury && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center" style={{ background: "rgba(0,0,0,0.7)" }} onClick={() => setShowTreasury(false)}>
                        <div className="w-[1200px] h-[700px] rounded-3xl p-12 border glass" style={{ background: BG, borderColor: GLASS.border }} onClick={(e) => e.stopPropagation()}>
                            <div className="flex items-center justify-between mb-8">
                                <div className="text-2xl font-semibold">Treasury — Detail</div>
                                <button onClick={() => setShowTreasury(false)} className="px-4 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Close</button>
                            </div>
                            <div className="grid grid-cols-3 gap-8">
                                <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="text-sm mb-2" style={{ color: TXT_MUTED }}>Available</div>
                                    <div className="text-3xl font-semibold">${treasury.balance}</div>
                                </div>
                                <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="text-sm mb-2" style={{ color: TXT_MUTED }}>Allocated</div>
                                    <div className="text-3xl font-semibold">${treasury.allocated}</div>
                                </div>
                                <div className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                    <div className="text-sm mb-2" style={{ color: TXT_MUTED }}>Net P&L (week)</div>
                                    <div className="text-3xl font-semibold text-emerald-300">+${treasury.weekPnL}</div>
                                </div>
                            </div>
                            <div className="mt-8 rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                <div className="text-lg font-medium mb-4">All Transactions</div>
                                <ul className="space-y-3">
                                    {treasury.tx.map(t => (
                                        <li key={t.id} className="flex items-center justify-between px-4 py-3 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                            <span>{t.ts} • {t.label}</span>
                                            <span className={t.amount >= 0 ? "text-emerald-300" : "text-rose-300"}>{t.amount >= 0 ? "+$" + t.amount : "-$" + Math.abs(t.amount)}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    </div>
                )}

                {showAgents && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center" style={{ background: "rgba(0,0,0,0.7)" }} onClick={() => setShowAgents(false)}>
                        <div className="w-[1200px] h-[700px] rounded-3xl p-12 border glass overflow-auto" style={{ background: BG, borderColor: GLASS.border }} onClick={(e) => e.stopPropagation()}>
                            <div className="flex items-center justify-between mb-8">
                                <div className="text-2xl font-semibold">KIP Agents — Detail</div>
                                <button onClick={() => setShowAgents(false)} className="px-4 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Close</button>
                            </div>
                            <div className="grid grid-cols-3 gap-6">
                                {agents.map(a => (
                                    <div key={a.id} className="rounded-2xl p-6 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
                                        <div className="flex items-center justify-between mb-4">
                                            <div>
                                                <div className="text-lg font-medium">{a.name}</div>
                                                <div className="text-sm" style={{ color: TXT_MUTED }}>{a.role}</div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-sm" style={{ color: TXT_MUTED }}>Net P&L</div>
                                                <div className={`text-2xl font-semibold ${a.net >= 0 ? "text-emerald-300" : "text-rose-300"}`}>${Math.abs(a.net)}</div>
                                            </div>
                                        </div>
                                        <div className="space-y-2 text-sm">
                                            <div className="flex justify-between"><span style={{ color: TXT_MUTED }}>Revenue</span><span className="text-emerald-300">${a.revenue}</span></div>
                                            <div className="flex justify-between"><span style={{ color: TXT_MUTED }}>Spending</span><span className="text-rose-300">${a.spend}</span></div>
                                        </div>
                                        <div className="mt-4 pt-4 border-t" style={{ borderColor: GLASS.border }}>
                                            <div className="text-xs" style={{ color: TXT_MUTED }}>Recent Actions</div>
                                            <div className="mt-2 space-y-1 text-xs">
                                                <div>Purchased data API (-$12)</div>
                                                <div>Completed report (+$150)</div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {showPheromind && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center" style={{ background: "rgba(0,0,0,0.7)" }} onClick={() => setShowPheromind(false)}>
                        <div className="w-[1200px] h-[700px] rounded-3xl p-12 border glass" style={{ background: BG, borderColor: GLASS.border }} onClick={(e) => e.stopPropagation()}>
                            <div className="flex items-center justify-between mb-8">
                                <div className="text-2xl font-semibold">Pheromind — Concept Trails</div>
                                <button onClick={() => setShowPheromind(false)} className="px-4 py-2 rounded-xl border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>Close</button>
                            </div>
                            <div className="rounded-2xl overflow-hidden" style={{ background: "rgba(255,255,255,0.06)" }}>
                                <svg viewBox="0 0 1200 500" className="w-full h-[400px]">
                                    {edges.map((e, i) => {
                                        const pos = (s) => s.split("").reduce((h, c) => (h * 31 + c.charCodeAt(0)) >>> 0, 0);
                                        const A = { x: 120 + (pos(e.a) % 800), y: 80 + ((pos(e.a) >> 5) % 340) };
                                        const B = { x: 120 + (pos(e.b) % 800), y: 80 + ((pos(e.b) >> 5) % 340) };
                                        return (
                                            <g key={i}>
                                                <defs>
                                                    <linearGradient id={`g${i}`} x1="0" y1="0" x2="1" y2="1">
                                                        <stop offset="0%" stopColor={PURPLE} />
                                                        <stop offset="100%" stopColor="#c084fc" />
                                                    </linearGradient>
                                                </defs>
                                                <line x1={A.x} y1={A.y} x2={B.x} y2={B.y} stroke={`url(#g${i})`} strokeWidth={Math.max(1.5, e.s * 8)} strokeOpacity={0.9} />
                                                <circle cx={A.x} cy={A.y} r={12} fill="#0f0e14" stroke="#a78bfa" strokeWidth={2} />
                                                <circle cx={B.x} cy={B.y} r={12} fill="#0f0e14" stroke="#a78bfa" strokeWidth={2} />
                                                <text x={A.x} y={A.y - 16} textAnchor="middle" fill="#fff" fontSize="12">{e.a}</text>
                                                <text x={B.x} y={B.y - 16} textAnchor="middle" fill="#fff" fontSize="12">{e.b}</text>
                                            </g>
                                        );
                                    })}
                                </svg>
                            </div>
                            <div className="mt-6 flex gap-3">
                                {edges.map((_, i) => (
                                    <button key={i} onClick={() => reinforce(i)} className="px-4 py-2 rounded-xl text-sm border" style={{ background: GLASS.bg, borderColor: GLASS.border }}>
                                        Reinforce #{i + 1}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                )}
				{showPalette && (
					<div className="fixed inset-0 z-50 flex items-start justify-center pt-24" style={{ background: "rgba(0,0,0,0.6)" }} onClick={()=>setShowPalette(false)}>
						<div className="w-[720px] rounded-2xl p-4 border" style={{ background: BG, borderColor: GLASS.border }} onClick={(e)=>e.stopPropagation()}>
							<input autoFocus value={searchQuery} onChange={(e)=>setSearchQuery(e.target.value)} placeholder="Search or type /command" className="w-full bg-transparent outline-none text-base px-4 py-3 rounded-xl border" style={{ borderColor: GLASS.border }} />
							<div className="mt-3 grid grid-cols-2 gap-3 text-sm">
								<div className="rounded-xl p-3 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
									<div className="text-xs mb-1" style={{ color: TXT_MUTED }}>Commands</div>
									<div className="flex flex-wrap gap-2">
										{filteredCommands.map(cmd => (
											<button key={cmd} onClick={()=>{setComposer(cmd+" "); setShowPalette(false); setPage('council');}} className="px-2 py-1 rounded-lg border text-xs" style={{ background: GLASS.bg, borderColor: GLASS.border }}>{cmd}</button>
										))}
									</div>
								</div>
								<div className="rounded-xl p-3 border" style={{ background: GLASS.subtle, borderColor: GLASS.border }}>
									<div className="text-xs mb-1" style={{ color: TXT_MUTED }}>Quick Nav</div>
									<div className="flex flex-wrap gap-2">
										{["council","kip","treasury","pheromind","calendar","projects","system"].map(p => (
											<button key={p} onClick={()=>{setPage(p); setShowPalette(false);}} className="px-2 py-1 rounded-lg border text-xs capitalize" style={{ background: GLASS.bg, borderColor: GLASS.border }}>{p === 'kip' ? 'KIP Engine' : p}</button>
										))}
									</div>
								</div>
							</div>
							<div className="mt-3 text-xs text-right" style={{ color: TXT_MUTED }}>Close: Esc • Open: Ctrl/Cmd+K</div>
						</div>
					</div>
				)}
            </div>
        );
    }

    ReactDOM.render(<HACUnifiedUI />, document.getElementById('root'));
    </script>
</body>
</html>


